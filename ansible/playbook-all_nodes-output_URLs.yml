---
- name: 'Output the URLs'
  hosts: 'all'
  gather_facts: true
  become: false

  tasks:

    - name: Wait for the URL to be available
      delegate_to: localhost
      ansible.builtin.uri:
        url: "https://immich.{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}.sslip.io"
        validate_certs: false
      register: result
      until: result.status == 200
      retries: 31
      delay: 10

    - name: 'Immich URL'
      ansible.builtin.debug:
        msg: "Your Immich instance is reachable here: https://immich.{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}.sslip.io"
